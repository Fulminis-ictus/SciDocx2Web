
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SciDocx2WebConversion &#8212; SciDocx2Web 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for SciDocx2WebConversion</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Convert academic papers in DOCX format to HTML. Tested on files generated with Word and LibreOffice.</span>

<span class="sd">This is the conversion module that is called by SciDocx2WebUI.</span>

<span class="sd">Created on March 30th, 2023\n</span>
<span class="sd">Author: Tim Reichert\n</span>
<span class="sd">Version: 1.0</span>

<span class="sd">Based on Mammoth: https://github.com/mwilliamson/python-mammoth</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">### IMPORTS ###</span>

<span class="c1"># Extraction and Conversion modules</span>
<span class="kn">import</span> <span class="nn">re</span> <span class="c1"># RegEx</span>
<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> <span class="c1"># XML</span>
<span class="kn">from</span> <span class="nn">html</span> <span class="kn">import</span> <span class="n">unescape</span> <span class="c1"># Replace HTML entities with their actual symbols</span>

<span class="c1"># GUI</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">messagebox</span>

<span class="c1">### POSSIBLE FUTURE TODO&#39;S ###</span>
<span class="c1">#- Replace Docx2Python with a custom function that generates a footnotes list.</span>
<span class="c1">#- Let users define the style map themselves (additional option on top of the already existing option with input fields).</span>
<span class="c1">#- Automatically create sections based on the headings.</span>
<span class="c1">#- Highlight section you&#39;re currently scrolling through in navbar.</span>
<span class="c1">#- Implement &quot;aria&quot; attributes for higher accessibility.</span>
<span class="c1">#- Escape characters that have a specific format template to make sure HTML-Code in the Word file displays as it should.</span>

<span class="c1">### MAIN CODE ###</span>
<span class="c1">## STYLE MAP</span>
<div class="viewcode-block" id="style_map_func"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.style_map_func">[docs]</a><span class="k">def</span> <span class="nf">style_map_func</span><span class="p">(</span><span class="n">custom_style_map</span><span class="p">,</span> <span class="n">headings</span><span class="p">,</span> <span class="n">media</span><span class="p">,</span> <span class="n">blockquotes</span><span class="p">,</span> <span class="n">tableCaptions</span><span class="p">,</span> <span class="n">bibliography</span><span class="p">,</span> <span class="n">ignorePNum</span><span class="p">,</span> <span class="n">paragraphNumberCheck</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Generates a style map based on the text in the input fields within the format template options section. Empty input fields are ignored. The style map detects templates applied to text and encloses them with an html element. For more information see: https://github.com/mwilliamson/python-mammoth#custom-style-map</span>
<span class="sd">    </span>
<span class="sd">    Headings -&gt; h1:fresh</span>
<span class="sd">    Media -&gt; p.mediacaption:fresh</span>
<span class="sd">    Blockquotes -&gt; blockquote:fresh</span>
<span class="sd">    Table Captions -&gt; caption:fresh</span>
<span class="sd">    Bibliography -&gt; p.bibliography:fresh</span>
<span class="sd">    Ignore Paragraph Numbering -&gt; p.ignorePNum:fresh&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">headings</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">custom_style_map</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;p[style-name=&#39;</span><span class="si">{</span><span class="n">headings</span><span class="si">}</span><span class="s2">&#39;] =&gt; h1:fresh&quot;</span>
    <span class="k">if</span> <span class="n">media</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">custom_style_map</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">p[style-name=&#39;</span><span class="si">{</span><span class="n">media</span><span class="si">}</span><span class="s2">&#39;] =&gt; p.mediacaption:fresh&quot;</span>
    <span class="k">if</span> <span class="n">blockquotes</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">custom_style_map</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">p[style-name=&#39;</span><span class="si">{</span><span class="n">blockquotes</span><span class="si">}</span><span class="s2">&#39;] =&gt; blockquote:fresh&quot;</span>
    <span class="k">if</span> <span class="n">tableCaptions</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">custom_style_map</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">p[style-name=&#39;</span><span class="si">{</span><span class="n">tableCaptions</span><span class="si">}</span><span class="s2">&#39;] =&gt; caption:fresh&quot;</span>
    <span class="k">if</span> <span class="n">bibliography</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">custom_style_map</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">p[style-name=&#39;</span><span class="si">{</span><span class="n">bibliography</span><span class="si">}</span><span class="s2">&#39;] =&gt; p.bibliography:fresh&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ignorePNum</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">paragraphNumberCheck</span><span class="p">):</span>
        <span class="n">custom_style_map</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">p[style-name=&#39;</span><span class="si">{</span><span class="n">ignorePNum</span><span class="si">}</span><span class="s2">&#39;] =&gt; p.ignorePNum:fresh&quot;</span>

    <span class="k">return</span> <span class="n">custom_style_map</span></div>

<span class="c1">## IMPORT INPUT FILE</span>
<div class="viewcode-block" id="enclose_body"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.enclose_body">[docs]</a><span class="k">def</span> <span class="nf">enclose_body</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">bodyCheckVar</span><span class="p">,</span> <span class="n">pageTitleEntryText</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Encloses the imported file with &lt;body&gt; tags to make it navigable with xpath.</span>

<span class="sd">    If &quot;Only export the body?&quot; is unchecked:</span>
<span class="sd">    Adds &lt;html&gt;, &lt;head&gt; and &lt;title&gt; elements. Also sets the charset to UTF-8 and adds the page title if the &quot;Page title&quot; field isn&#39;t empty.</span>
<span class="sd">    </span>
<span class="sd">    Additionally, the grid container and main grid &lt;div&gt; tags are inserted.&#39;&#39;&#39;</span>

    <span class="c1"># &quot;Only export the body?&quot; is checked</span>
    <span class="k">if</span> <span class="n">bodyCheckVar</span><span class="p">:</span>
        <span class="n">bodyxml</span> <span class="o">=</span> <span class="s1">&#39;&lt;body&gt;&lt;div class=&quot;gridContainer&quot;&gt;&lt;div class=&quot;mainGrid&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nb">input</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&#39;</span>

    <span class="c1"># &quot;Only export the body?&quot; is unchecked and the page title field isn&#39;t empty</span>
    <span class="k">elif</span> <span class="n">pageTitleEntryText</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">bodyxml</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;title&gt;</span><span class="si">{</span><span class="n">pageTitleEntryText</span><span class="si">}</span><span class="s1">&lt;/title&gt;&lt;meta charset=</span><span class="se">\&quot;</span><span class="s1">UTF-8</span><span class="se">\&quot;</span><span class="s1">&gt;&lt;/meta&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;gridContainer&quot;&gt;&lt;div class=&quot;mainGrid&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nb">input</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span>

    <span class="c1"># &quot;Only export the body?&quot; is unchecked and the page title field is empty</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bodyxml</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;meta charset=</span><span class="se">\&quot;</span><span class="s1">UTF-8</span><span class="se">\&quot;</span><span class="s1">&gt;&lt;/meta&gt;&lt;/head&gt;&lt;body&gt;&lt;div class=&quot;gridContainer&quot;&gt;&lt;div class=&quot;mainGrid&quot;&gt;&#39;</span> <span class="o">+</span> <span class="nb">input</span> <span class="o">+</span> <span class="s1">&#39;&lt;/div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span>
    <span class="n">bodyxml</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<span class="c1">## FOOTNOTES</span>
<div class="viewcode-block" id="create_footnotes_list"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.create_footnotes_list">[docs]</a><span class="k">def</span> <span class="nf">create_footnotes_list</span><span class="p">(</span><span class="n">footnotes</span><span class="p">,</span> <span class="n">abbreviateFootnotesNumber</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Flattens the nested footnotes that were imported with docx2python and reformats them:</span>

<span class="sd">    Replaces &quot;footnoteN) Footnote content&quot; with just &quot;Footnote content&quot;.</span>

<span class="sd">    If the footnote abbreviation field is not empty:</span>
<span class="sd">    Deletes all tags to prevent tags that are never closed due to the abbreviation process.</span>
<span class="sd">    </span>
<span class="sd">    Else:</span>
<span class="sd">    Only removes spans, which usually feature unwanted color stylings.</span>
<span class="sd">    </span>
<span class="sd">    Example: &quot;footnoteN This is a &lt;span&gt;footnote.&lt;/span&gt;&quot; -&gt; &quot;This is a footnote.&quot;&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">footnotes</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">abbreviateFootnotesNumber</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(&lt;.*?&gt;)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(&lt;span)(.*?)(&gt;)(.*?)(&lt;/span&gt;)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\4&#39;</span><span class="p">,</span> <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(footnote)(\d+)\)\t (.*)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\3&#39;</span><span class="p">,</span> <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">footnotes</span></div>

<div class="viewcode-block" id="abbreviate_footnotes"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.abbreviate_footnotes">[docs]</a><span class="k">def</span> <span class="nf">abbreviate_footnotes</span><span class="p">(</span><span class="n">footnotes</span><span class="p">,</span> <span class="n">abbreviateFootnotesNumber</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Abbreviates footnotes according to the number in the &quot;Abbreviate tooltips after how many symbols?&quot; input field and adds &quot;[...]&quot; to the end of abbreviated footnotes.</span>

<span class="sd">    If the input field is empty:</span>
<span class="sd">    Skips this step altogether.</span>

<span class="sd">    If something other than an integer is given: </span>
<span class="sd">    Tooltip abbreviation is skipped with an error message indicating that the abbreviation was unsuccessful but the rest of the conversion process continues as normal.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">abbreviateFootnotesNumber</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">abbreviateFootnotesNumber</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">abbreviateFootnotesNumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">abbreviateFootnotesNumber</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">footnotes</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">abbreviateFootnotesNumber</span><span class="p">:</span>
                    <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">footnotes</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="n">abbreviateFootnotesNumber</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;[...]&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">messagebox</span><span class="o">.</span><span class="n">showerror</span><span class="p">(</span><span class="s1">&#39;Tooltip abbreviation unsuccessful&#39;</span><span class="p">,</span> <span class="s1">&#39;The file conversion will continue but the tooltip abbreviation was unsuccessful. The tooltip abbreviation input field (&quot;Abbreviate tooltips after how many symbols?&quot;) only accepts integers.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">footnotes</span></div>

<div class="viewcode-block" id="add_wbr_footnotes"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.add_wbr_footnotes">[docs]</a><span class="k">def</span> <span class="nf">add_wbr_footnotes</span><span class="p">(</span><span class="n">footnotesAbbr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Finds all slashes within footnotes and adds &lt;wbr&gt; tags after them to ensure that links automatically receive a line break when necessary.&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">footnotesAbbr</span><span class="p">)):</span>
        <span class="n">footnotesAbbr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;/&lt;wbr&gt;&#39;</span><span class="p">,</span> <span class="n">footnotesAbbr</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">footnotesAbbr</span></div>

<div class="viewcode-block" id="insert_footnotes"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.insert_footnotes">[docs]</a><span class="k">def</span> <span class="nf">insert_footnotes</span><span class="p">(</span><span class="n">tooltipsCheckVar</span><span class="p">,</span> <span class="n">bodyxml</span><span class="p">,</span> <span class="n">footnotesAbbr</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;If &quot;Add tooltips to footnotes?&quot; is checked:</span>
<span class="sd">    Finds &lt;sup&gt; tags that contain links with an ID starting with &quot;footnote-ref&quot;, which denotes footnote numbers in the main text. It then creates a tooltip text &lt;span&gt; and appends it to the end of the found &lt;sup&gt; tags. The whole element, including the &lt;sup&gt; element and tooltip text &lt;span&gt; element, is then enclosed with a tooltip &lt;span&gt; element. Structure derived from: https://www.w3schools.com/howto/howto_css_tooltip.asp</span>
<span class="sd">    </span>
<span class="sd">    Example: &lt;sup&gt;&lt;a href=&quot;#footnote-N&quot; id=&quot;footnote-ref-N&quot;&gt;[N]&lt;/a&gt;&lt;/sup&gt; -&gt; </span>
<span class="sd">    &lt;span class=&quot;tooltip&quot;&gt;&lt;sup&gt;&lt;a href=&quot;#footnote-N&quot; id=&quot;footnote-ref-N&quot;&gt;[N]&lt;/a&gt;&lt;span class=&quot;tooltiptext&quot;&gt;Footnote content.&lt;/span&gt;&lt;/sup&gt;&lt;/span&gt;&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">tooltipsCheckVar</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//sup/a[contains(@id, &quot;footnote-ref&quot;)]/..&#39;</span><span class="p">):</span> 
            <span class="c1"># create tooltip and tooltip text &lt;span&gt;s</span>
            <span class="n">tooltiptextSpan</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span>
            <span class="n">tooltiptextSpan</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tooltiptext&#39;</span>
            <span class="n">tooltipSpan</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span>
            <span class="n">tooltipSpan</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;tooltip&#39;</span>

            <span class="c1"># insert footnote text and append tooltiptext &lt;span&gt; to end of current footnote sections </span>
            <span class="n">tooltiptextSpan</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">footnotesAbbr</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tooltiptextSpan</span><span class="p">)</span>

            <span class="c1"># enclose footnote sections (including the tooltiptext &lt;span&gt;s) with tooltip &lt;span&gt;s</span>
            <span class="n">tooltipSpan</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tooltipSpan</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="adjust_footnotes"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.adjust_footnotes">[docs]</a><span class="k">def</span> <span class="nf">adjust_footnotes</span><span class="p">(</span><span class="n">tooltipsCheckVar</span><span class="p">,</span> <span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;If &quot;Add tooltips to footnotes?&quot; is checked:</span>
<span class="sd">    Removes the &lt;sup&gt; elements and creates new ones within the &lt;a&gt; tags. Also removes the square brackets around the footnote numbers, and moves the numbers from the &lt;a&gt; tags into the &lt;sup&gt; tags.</span>
<span class="sd">    This whole process ensures that only the footnote numbers, not the footnote text within the tooltips, is enclosed by the &lt;sup&gt; elements.</span>

<span class="sd">    Example: &lt;sup&gt;&lt;span class=&quot;tooltip&quot;&gt;&lt;a href=&quot;#footnote-N&quot; id=&quot;footnote-ref-N&quot;&gt;[N]&lt;/a&gt;&lt;span class=&quot;tooltiptext&quot;&gt;Footnote content.&lt;/span&gt;&lt;/span&gt;&lt;/sup&gt; -&gt;</span>
<span class="sd">    &lt;span class=&quot;tooltip&quot;&gt;&lt;a href=&quot;#footnote-N&quot; id=&quot;footnote-ref-N&quot;&gt;&lt;sup&gt;N&lt;/sup&gt;&lt;/a&gt;&lt;span class=&quot;tooltiptext&quot;&gt;Footnote content.&lt;/span&gt;&lt;/span&gt;</span>
<span class="sd">    </span>
<span class="sd">    Else: Only the square brackets around the footnote numbers are removed.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">tooltipsCheckVar</span><span class="p">:</span>
        <span class="c1"># remove &lt;sup&gt; elements</span>
        <span class="k">while</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//sup/span[contains(@class, &quot;tooltip&quot;)]/..&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//sup/span[contains(@class, &quot;tooltip&quot;)]/..&#39;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">addnext</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">getparent</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        
        <span class="c1"># add &lt;sup&gt; elements containing the footnote numbers at the right position</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//a[contains(@id, &quot;footnote-ref&quot;)]&#39;</span><span class="p">):</span>
            <span class="c1"># transform text from [N] to N, insert it into the &lt;sup&gt; elements, remove it from the &lt;a&gt; element</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\[)(.*)(\])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\2&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;sup&#39;</span><span class="p">)</span>
            <span class="n">sup</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="c1"># move &lt;sup&gt; elements to the right positions</span>
            <span class="n">sup</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sup</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//a[contains(@id, &quot;footnote-ref&quot;)]&#39;</span><span class="p">):</span>
            <span class="c1"># transform text from [N] to N</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(\[)(.*)(\])&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\2&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="footnotes_bottom_separate"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.footnotes_bottom_separate">[docs]</a><span class="k">def</span> <span class="nf">footnotes_bottom_separate</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">,</span> <span class="n">commentBottomFootnotes</span><span class="p">,</span> <span class="n">breakElement</span><span class="p">,</span> <span class="n">hrElement</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;If a footnote list at the bottom of the main text exists:</span>
<span class="sd">    Adds elements before the footnote list at the bottom to separate it from the rest: &lt;br/&gt;, &lt;hr/&gt; and the comment &quot;Bottom footnotes&quot;.&#39;&#39;&#39;</span>

    <span class="n">bottomFootnotes</span> <span class="o">=</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//li[@id=&quot;footnote-1&quot;]/..&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">bottomFootnotes</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bottomFootnotes</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">commentBottomFootnotes</span><span class="p">)</span>
        <span class="n">bottomFootnotes</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">breakElement</span><span class="p">)</span>
        <span class="n">bottomFootnotes</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">hrElement</span><span class="p">)</span>
        <span class="n">bottomFootnotes</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">breakElement</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<span class="c1">## TEXT</span>
<div class="viewcode-block" id="add_wbr_text"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.add_wbr_text">[docs]</a><span class="k">def</span> <span class="nf">add_wbr_text</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Finds all slashes in links within the main text and adds &lt;wbr&gt; tags after them to ensure that links automatically receive a line break when necessary.&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//a&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;/&lt;wbr&gt;&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="add_Head_IDs"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.add_Head_IDs">[docs]</a><span class="k">def</span> <span class="nf">add_Head_IDs</span><span class="p">(</span><span class="n">headingsIDVar</span><span class="p">,</span> <span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;If &quot;Automatically add IDs to headings?&quot; is checked:</span>
<span class="sd">    Adds IDs to all found &lt;h1&gt; elements following the form &quot;headingN&quot; where &quot;N&quot; is an integer counting upwards.</span>
<span class="sd">    </span>
<span class="sd">    Example: &lt;h1 id=&quot;heading1&quot;&gt;First heading&lt;/h1&gt;, &lt;h1 id=&quot;heading2&quot;&gt;Second heading&lt;/h1&gt; etc.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">headingsIDVar</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//h1&#39;</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;heading&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="create_navigation"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.create_navigation">[docs]</a><span class="k">def</span> <span class="nf">create_navigation</span><span class="p">(</span><span class="n">navigationVar</span><span class="p">,</span> <span class="n">navigationTypeVar</span><span class="p">,</span> <span class="n">findH1</span><span class="p">,</span> <span class="n">navigationElement</span><span class="p">,</span> <span class="n">commentNavigation</span><span class="p">,</span> <span class="n">h1Navigation</span><span class="p">,</span> <span class="n">navGridDiv</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;If &quot;Create navigation?&quot; is checked:</span>
<span class="sd">    Creates a navigation by compiling a list of all &lt;h1&gt; elements. Each navigation item is a paragraph or a button, depending on which radio button option is activated. Adds links with href attributes that link each navigation item to their respective heading following the form &quot;#headingN&quot; where &quot;N&quot; is an integer counting upwards.</span>
<span class="sd">    </span>
<span class="sd">    Example: &lt;button&gt;&lt;a href=&quot;#heading1&quot;&gt;Navigation to first heading&lt;/a&gt;&lt;/button&gt;</span>
<span class="sd">    </span>
<span class="sd">    Encloses everything with a &lt;div&gt; with the class &quot;navGrid&quot;.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">navigationVar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">findH1</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">findH1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">navigationTypeVar</span> <span class="o">==</span> <span class="s1">&#39;paragraph&#39;</span><span class="p">:</span>
                    <span class="n">elementPorB</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">elementPorB</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;button&#39;</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">elementPorB</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;href&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#heading&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">itertext</span><span class="p">())</span> <span class="c1"># makes sure it receives the full text without it stopping at inner tags</span>
                <span class="n">navigationElement</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elementPorB</span><span class="p">)</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="c1"># create navigation grid</span>
            <span class="n">navGridDiv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">commentNavigation</span><span class="p">)</span>
            <span class="n">navGridDiv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h1Navigation</span><span class="p">)</span>
            <span class="n">navGridDiv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">navigationElement</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">navGridDiv</span></div>

<div class="viewcode-block" id="remove_toc_and_head"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.remove_toc_and_head">[docs]</a><span class="k">def</span> <span class="nf">remove_toc_and_head</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Removes Word&#39;s &quot;Table Of Contents&quot; and &quot;_heading&quot; IDs. Both of those consist of non-closed &quot;a&quot;-tags that lead to display errors.&#39;&#39;&#39;</span>

    <span class="n">findToc</span> <span class="o">=</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//a[contains(@id, &quot;_Toc&quot;)]/..&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">findToc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">findToc</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">tail</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">tail</span>
                <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">tail</span>

    <span class="n">findHead</span> <span class="o">=</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;.//a[contains(@id, &quot;_heading&quot;)]/..&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">findHead</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">findHead</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                <span class="n">tail</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">tail</span>
                <span class="n">node</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">tail</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="add_cite"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.add_cite">[docs]</a><span class="k">def</span> <span class="nf">add_cite</span><span class="p">(</span><span class="n">tooltiptextPath</span><span class="p">,</span> <span class="n">bodyxml</span><span class="p">,</span> <span class="n">footnotes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Adds a cite attribute to &lt;blockquote&gt; elements. Inserts the footnote text as the cite value by using the footnote number at the end of the blockquote as the index of the footnote list.&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//blockquote&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">tooltiptextPath</span><span class="p">):</span>
            <span class="n">footnotenumber</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">tooltiptextPath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="n">citetext</span> <span class="o">=</span> <span class="n">footnotes</span><span class="p">[</span><span class="n">footnotenumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;cite&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">citetext</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="file_insertion_message"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.file_insertion_message">[docs]</a><span class="k">def</span> <span class="nf">file_insertion_message</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Adds the comment &quot;Insert Media&quot; before &lt;p&gt; elements that have the media caption class to alert the user to the fact that they might need to manually insert media at that point.&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//p[contains(@class, &quot;mediacaption&quot;)]&#39;</span><span class="p">):</span>
        <span class="n">commentMedia</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Comment</span><span class="p">(</span><span class="s1">&#39; Insert Media &#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">addprevious</span><span class="p">(</span><span class="n">commentMedia</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="move_table_caption"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.move_table_caption">[docs]</a><span class="k">def</span> <span class="nf">move_table_caption</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Moves the &lt;caption&gt; elements to the beginning of the &lt;table&gt; elements to make sure that the &lt;table&gt; elements are well-formed.&#39;&#39;&#39;</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//caption&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;table&#39;</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">getprevious</span><span class="p">()</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="paragraph_numbering"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.paragraph_numbering">[docs]</a><span class="k">def</span> <span class="nf">paragraph_numbering</span><span class="p">(</span><span class="n">paragraphNumberCheckVar</span><span class="p">,</span> <span class="n">bodyxml</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;If &quot;Number the paragraphs?&quot; is checked:</span>
<span class="sd">    Adds numbers to the beginning of each paragraph and each blockquote following the form [N] where N is an integer counting upwards. Skips paragraphs that have the &quot;ignorePNum&quot;, &quot;mediacaption&quot; or &quot;bibliography&quot; classes.&#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">paragraphNumberCheckVar</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">bodyxml</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@class=&quot;mainGrid&quot;]/p[not(@class=&quot;mediacaption&quot;) and not(@class=&quot;ignorePNum&quot;) and not(@class=&quot;bibliography&quot;)]|//blockquote&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span> <span class="o">+</span> <span class="n">node</span><span class="o">.</span><span class="n">text</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;] &#39;</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">bodyxml</span></div>

<div class="viewcode-block" id="write_html"><a class="viewcode-back" href="../SciDocx2WebConversion.html#SciDocx2WebConversion.write_html">[docs]</a><span class="k">def</span> <span class="nf">write_html</span><span class="p">(</span><span class="n">navigationVar</span><span class="p">,</span> <span class="n">bodyCheckVar</span><span class="p">,</span> <span class="n">cssCheckVar</span><span class="p">,</span> <span class="n">cssXML</span><span class="p">,</span> <span class="n">navGridDiv</span><span class="p">,</span> <span class="n">bodyxml</span><span class="p">,</span> <span class="n">outputPath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Assembles the individual sections (navigation, css, body) and writes them to an html file.</span>
<span class="sd">    </span>
<span class="sd">    If &quot;Create navigation?&quot; is unchecked:</span>
<span class="sd">    Skips navigation section.</span>
<span class="sd">    </span>
<span class="sd">    If &quot;Add suggested css?&quot; is unchecked:</span>
<span class="sd">    Skips css section.</span>
<span class="sd">    </span>
<span class="sd">    If &quot;Only export the body?&quot; is unchecked: </span>
<span class="sd">    &quot;&lt;!DOCTYPE html&gt;&quot; is added to the beginning to create a well formed html file. This is not necessary if only the body is exported since it&#39;s an incomplete html file without the &lt;head&gt; element.&#39;&#39;&#39;</span>

    <span class="c1"># navigation</span>
    <span class="k">if</span> <span class="n">navigationVar</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">bodyCheckVar</span><span class="p">:</span>
            <span class="n">bodyxml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">navGridDiv</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bodyxml</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">navGridDiv</span><span class="p">)</span>

    <span class="c1"># css</span>
    <span class="k">if</span> <span class="n">cssCheckVar</span><span class="p">:</span>
        <span class="n">bodyxml</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cssXML</span><span class="p">)</span>

    <span class="c1"># doctype declaration</span>
    <span class="k">if</span> <span class="n">bodyCheckVar</span><span class="p">:</span>
        <span class="n">exportableBodyxml</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">exportableBodyxml</span> <span class="o">=</span> <span class="s2">&quot;&lt;!DOCTYPE html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">bodyxml</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># write to file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">outputPath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">unescape</span><span class="p">(</span><span class="n">exportableBodyxml</span><span class="p">))</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SciDocx2Web</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">SciDocx2Web</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Tim Reichert.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>